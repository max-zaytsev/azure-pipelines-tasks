parameters:
- name: task_name
  type: string

steps:
# - checkout: self
#   fetchDepth: 1

# - checkout: AzureDevOps
#   fetchDepth: 1

# # Use node 8, npm 5
# - task: NodeTool@0
#   displayName: Use node 10
#   inputs:
#     versionSpec: 10.x

# - script: |
#     cd azure-pipelines-tasks
#     npm install npm install
#   displayName: npm install
  
# - task: DownloadBuildArtifacts@0
#   inputs:
#     buildType: specific
#     buildVersionToDownload: specific
#     project: TestProject
#     buildId: 841
#     pipeline: FORK-TASKS
#     artifactName: IndividualNugetPackages
#     downloadPath: IndividualNugetPackagesDownloaded
#   displayName: Download Artifact

# - script: node azure-pipelines-tasks\ci\courtesy-push\courtesy-push.js AzureDevOps IndividualNugetPackagesDownloaded\IndividualNugetPackages\unified_deps.xml
#   displayName: Update unified deps

# returns currentSprint
- template: set-current-sprint-variable.yml

- powershell: |
    Write-Host $(currentSprint)
  displayName: CHECk


# returns branchName
- template: generate-branch-name.yml
  parameters:
    postfix: hotfix
    currentSprint: "$(currentSprint)"

- powershell:  |
    cd azure-pipelines-tasks
    npm install npm install
    Write-Host $(branchName)
    cd ../azure-pipelines-tasks/ci/courtesy-push
    npm install

    node push-hotfix-branch.js
    node open-hotfix-pr.js
  env:
    TOKEN: $(AzDoToken)
    TASK_NAME: ${{ parameters.task_name }}
    REPOSITORY: AzureDevOps
    BRANCH: $(branchName)
